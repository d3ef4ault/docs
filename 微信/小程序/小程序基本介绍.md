# 小程序基本介绍

## 目录结构

小程序包含一个描述整体程序的 `app` 和多个描述各自页面的 `page`。

一个小程序**主体部分**由三个文件组成，必须放在**项目的根目录**，如下：

| 文件     | 必须 | 作用             |
| -------- | ---- | ---------------- |
| app.js   | 是   | 小程序逻辑       |
| app.json | 是   | 小程序公共配置   |
| app.wxss | 否   | 小程序公共样式表 |

小程序页面由四个文件组成：
| 文件类型 | 必须 | 作用       |
| -------- | ---- | ---------- |
| js       | 是   | 页面逻辑   |
| wxml     | 否   | 页面结构   |
| json     | 是   | 页面配置   |
| wxss     | 否   | 页面样式表 |

## 配置

### 全局配置

`app.json` 文件用来对微信小程序进行全局配置，决定

- 页面文件的路径
- 窗口表现
- 设置网络超时时间
- 设置多 tab 等。

以下为示例：

```json
{
  "pages": [
    "pages/index/index",
    "pages/logs/index"
  ],
  "window": {
    "navigationBarTitleText": "Demo"
  },
  "tabBar": {
    "list": [{
      "pagePath": "pages/index/index",
      "text": "首页"
    }, {
      "pagePath": "pages/logs/logs",
      "text": "日志"
    }]
  },
  "networkTimeout": {
    "request": 10000,
    "downloadFile": 10000
  },
  "debug": true
}
```

**`app.json` 配置项列表**

- pages —— 页面路径列表
- window —— 全局的默认窗口表现
- tabBar —— 底部 tab 栏的表现
- networkTimeout —— 网络超时时间
- debug —— 是否开启 debug 模式，默认关闭
- functionalPages —— 是否启用插件功能页，默认关闭
- subPackages —— 分包结构配置
- workers —— `Worker` 代码放置的目录
- requiredBackgroundModes —— 需要在后台使用的能力，如「音乐播放」
- plugins —— 使用到的插件
- preloadRule —— 分包预下载规则
- resizable —— `iPad` 小程序是否支持屏幕旋转，默认关闭

#### pages

用于指定小程序由哪些页面组成，每一项都对应一个页面的 `路径+文件名` 信息。**文件名不需要写文件后缀**，框架会自动去寻找对于位置的 `.json, .js, .wxml, .wxss` 四个文件进行处理。

**数组的第一项代表小程序的初始页面（首页）。小程序中新增/减少页面（除分包页面在 `subPackages` 修改外），都需要对 `pages` 数组进行修改。**

```json
如开发目录为：

├── app.js
├── app.json
├── app.wxss
├── pages
│   │── index
│   │   ├── index.wxml
│   │   ├── index.js
│   │   ├── index.json
│   │   └── index.wxss
│   └── logs
│       ├── log.wxml
│       └── log.js
└── utils

则需要在 app.json 中写

{
  "pages":[
    "pages/index/index",
    "pages/logs/logs"
  ]
}
```

#### window

用于设置小程序的

- 状态栏
- 导航条
- 标题
- 窗口背景色

##### navigationBarBackgroundColor

- 导航栏背景颜色
- 默认值：`#000000`

##### navigationBarTextStyle

- 导航栏标题颜色，仅支持 `black / white`
- 默认值：`white`

##### navigationBarTitleText

- 导航栏标题文字内容

##### navigationStyle

- 导航栏样式，仅支持以下值：
  - `default` 默认样式
  - `custom` 自定义导航栏，只保留右上角胶囊按钮
- 默认值：`default`

##### backgroundColor

- 窗口的背景色
- 默认值：`#ffffff`

##### backgroundTextStyle

- 下拉 `loading` 的样式，仅支持 `dark / light`
- 默认值：`dark`

##### backgroundColorTop

- 顶部窗口的背景色，**仅 iOS 支持**
- 默认值：`#ffffff`

##### backgroundColorBottom

- 底部窗口的背景色，**仅 iOS 支持**
- 默认值：`#ffffff`

##### enablePullDownRefresh

- 是否全局开启下拉刷新。
- 默认值：`false`

##### onReachBottomDistance

- 页面上拉触底事件触发时距页面底部距离，单位为px
- 默认值：`50`

**注：`navigationStyle` 只在 `app.json` 中生效。开启 `custom` 后，低版本客户端需要做好兼容。开发者工具基础库版本切到 1.7.0（不代表最低版本，只供调试用）可方便切到旧视觉**

示例：

```json
{
  "window":{
    "navigationBarBackgroundColor": "#ffffff",
    "navigationBarTextStyle": "black",
    "navigationBarTitleText": "微信接口功能演示",
    "backgroundColor": "#eeeeee",
    "backgroundTextStyle": "light"
  }
}
```

#### tabBar

如果小程序是一个多 tab 应用（客户端窗口的底部或顶部有 tab 栏可以切换页面），可以通过 tabBar 配置项指定 tab 栏的表现，以及 tab 切换时显示的对应页面。

##### color 【必填】

- tab 上的文字默认颜色

##### selectedColor 【必填】

- tab 上的文字选中时的颜色

##### backgroundColor 【必填】

- tab 的背景色

##### borderStyle 【必填】

- tab tabbar上边框的颜色， 仅支持 `black / white`
- 默认值：`black`

##### list 【必填】

- tab 的列表，接受一个数组，只能配置最少2个、最多5个 tab
- tab 按数组的顺序排序，每个项都是一个对象，其属性值如下：
  - pagePath 【必填】
    - 页面路径，必须在 pages 中先定义
  - text 【必填】
    - tab 上按钮文字
  - iconPath
    - 图片路径，**icon 大小限制为40kb**，建议尺寸为 `81px * 81px`，**不支持网络图片**
    - **当 postion 为 top 时，不显示 icon**
  - selectedIconPath
    - 选中时的图片路径，**icon 大小限制为40kb**，建议尺寸为 `81px * 81px`，**不支持网络图片**
    - **当 postion 为 top 时，不显示 icon**

##### position 【必填】

- tabBar的位置，仅支持 `bottom / top`
- 默认值：`bottom`

#### networkTimeout

各类网络请求的超时时间，单位均为毫秒。

##### request

- `wx.request` 的超时时间
- 单位: 毫秒
- 默认值：`60000`

##### connectSocket

- `wx.connectSocket` 的超时时间
- 单位: 毫秒
- 默认值：`60000`

##### uploadFile

- `wx.uploadFile` 的超时时间
- 单位: 毫秒
- 默认值：`60000`

##### downloadFile

- `wx.downloadFile` 的超时时间
- 单位: 毫秒
- 默认值：`60000`

#### debug

可以在开发者工具中开启 debug 模式，在开发者工具的控制台面板，调试信息以 info 的形式给出，其信息有Page的注册，页面路由，数据更新，事件触发等。可以帮助开发者快速定位一些常见的问题。

#### functionalPages

启用插件功能页时，插件所有者小程序需要设置其 `functionalPages` 为 `true`

#### subPackages

启用**分包加载**时，声明项目分包结构

#### workers

使用 Worker 处理多线程任务时，设置 Worker 代码放置的目录

#### requiredBackgroundModes

申明需要后台运行的能力，类型为数组。目前支持以下项目：

##### `audio` 后台音乐播放

示例：

```json
{
  "pages": ["pages/index/index"],
  "requiredBackgroundModes": ["audio"]
}
```

**注：在此处申明了后台运行的接口，开发版和体验版上可以直接生效，正式版还需通过审核。**

#### plugins

声明小程序需要使用的插件

#### preloadRule

声明分包预下载的规则

#### resizable

在 iPad 上运行的小程序可以设置支持屏幕旋转

### 页面配置

每一个小程序页面也可以使用`.json`文件来对本页面的窗口表现进行配置

**页面的配置只能设置 `app.json` 中部分 `window` 配置项的内容，页面中配置项会覆盖 `app.json` 的 `window` 中相同的配置项**

- navigationBarBackgroundColor
  - 导航栏背景颜色
  - 默认值：`#000000`
- navigationBarTextStyle
  - 导航栏标题颜色，仅支持 `black / white`
  - 默认值：`white`
- navigationBarTitleText
  - 导航栏标题文字内容
- backgroundColor
  - 窗口的背景色
  - 默认值： `#ffffff`
- backgroundTextStyle
  - 下拉 loading 的样式，仅支持 `dark / light`
  - 默认值：`dark`
- enablePullDownRefresh
  - 是否全局开启下拉刷新
  - 默认值：`false`
- onReachBottomDistance
  - 页面上拉触底事件触发时距页面底部距离
  - 单位：`px`
  - 默认值：`50`
- disableScroll
  - 设置为 true 则页面整体不能上下滚动
  - **只在页面配置中有效，无法在 app.json 中设置该项**
  - 默认值：`false`

示例：

```json
{
  "navigationBarBackgroundColor": "#ffffff",
  "navigationBarTextStyle": "black",
  "navigationBarTitleText": "微信接口功能演示",
  "backgroundColor": "#eeeeee",
  "backgroundTextStyle": "light"
}
```

**页面的`.json`只能设置 `window` 相关的配置项，以决定本页面的窗口表现，所以无需写 `window` 这个键**